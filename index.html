<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi2 Sentinel | v15 Cyberdeck</title>
    
    <!-- FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;800&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- THEME -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#030304',
                        panel: '#09090b',
                        primary: '#00f3ff', 
                        accent: '#a855f7',
                        success: '#10b981',
                        danger: '#ff003c',
                        dim: '#475569'
                    },
                    fontFamily: {
                        mono: ['"JetBrains Mono"', 'monospace'],
                        hud: ['"Rajdhani"', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #030304; color: #e2e8f0; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 4px; background: #09090b; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: #00f3ff; }

        /* CYBERPUNK GLASS */
        .glass {
            background: rgba(10, 10, 14, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 243, 255, 0.1);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
        }
        
        /* CRT SCANLINE */
        .scanline {
            position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(to bottom, rgba(0, 243, 255, 0), rgba(0, 243, 255, 0.1), rgba(0, 243, 255, 0));
            animation: scan 6s linear infinite; pointer-events: none; z-index: 50; opacity: 0.4;
        }
        @keyframes scan { 0% {top:-10%;} 100% {top:110%;} }

        /* GLITCH EFFECT HOVER */
        .glitch-hover:hover {
            animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) both infinite;
            color: #00f3ff;
        }
        @keyframes glitch {
            0% { transform: translate(0) }
            20% { transform: translate(-2px, 2px) }
            40% { transform: translate(-2px, -2px) }
            60% { transform: translate(2px, 2px) }
            80% { transform: translate(2px, -2px) }
            100% { transform: translate(0) }
        }

        /* CURSOR BLINK */
        .cursor::after { content: '█'; animation: blink 1s step-end infinite; color: #00f3ff; margin-left: 2px;}
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* ACHIEVEMENT UNLOCK POP */
        .pop-in { animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { opacity: 0; transform: scale(0.5); } 100% { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="font-hud min-h-screen flex flex-col bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')]">

    <div class="fixed inset-0 bg-gradient-to-b from-transparent via-bg/80 to-primary/5 pointer-events-none z-0"></div>
    <div class="scanline"></div>

    <!-- HEADER -->
    <header class="border-b border-white/5 bg-bg/95 backdrop-blur z-50 sticky top-0 h-16 flex-none relative">
        <div class="max-w-7xl mx-auto px-6 h-full flex justify-between items-center">
            <div class="flex items-center gap-4 group">
                <div class="w-10 h-10 border border-primary/40 bg-primary/5 flex items-center justify-center font-bold text-xl text-primary rounded tech-glow transition-all group-hover:scale-110">π²</div>
                <div class="flex flex-col">
                    <h1 class="font-bold tracking-[0.25em] text-sm text-white leading-none glitch-hover cursor-default">SENTINEL</h1>
                    <span class="text-[9px] text-primary uppercase tracking-widest leading-none mt-1 opacity-70">Cyberdeck v15.0</span>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                 <button id="soundToggle" onclick="toggleMute()" class="w-8 h-8 rounded border border-white/10 flex items-center justify-center hover:bg-white/5 transition text-dim hover:text-white">
                     <i class="fas fa-volume-up"></i>
                 </button>
                 <button onclick="toggleLang()" id="langBtn" class="font-mono text-[10px] border border-white/10 px-3 py-1.5 rounded hover:bg-white/5 transition text-dim hover:text-white uppercase font-bold">EN</button>
            </div>
        </div>
    </header>

    <!-- GRID -->
    <main class="flex-grow p-4 md:p-6 max-w-7xl mx-auto w-full grid grid-cols-1 lg:grid-cols-12 gap-5 relative z-10">

        <!-- LEFT: UPLINK & STATUS -->
        <aside class="lg:col-span-3 flex flex-col gap-4">
            
            <div class="glass p-5 rounded-lg flex flex-col gap-4 relative overflow-hidden h-[340px] group border-l-2 border-primary">
                <div class="absolute right-0 top-0 p-2 opacity-10 group-hover:opacity-30 transition"><i class="fas fa-microchip text-4xl"></i></div>
                <h2 class="text-xs font-bold text-gray-400 uppercase tracking-[0.2em] mb-2">SYSTEM UPLINK</h2>

                <!-- CONFIG FORM -->
                <div id="setupView" class="space-y-4">
                    <div class="space-y-1">
                        <label class="text-[9px] text-primary font-bold uppercase">Identity (Set1...)</label>
                        <input type="text" id="inp_addr" class="w-full bg-black/40 border border-white/10 p-2.5 text-[10px] font-mono rounded text-primary focus:border-primary focus:outline-none transition focus:shadow-[0_0_10px_rgba(0,243,255,0.2)]" placeholder="Wallet Address">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[9px] text-primary font-bold uppercase">Key Sequence (0x...)</label>
                        <input type="password" id="inp_pk" class="w-full bg-black/40 border border-white/10 p-2.5 text-[10px] font-mono rounded text-primary focus:border-primary focus:outline-none transition focus:shadow-[0_0_10px_rgba(0,243,255,0.2)]" placeholder="Private Key">
                    </div>
                    <button onclick="initConnection()" class="w-full bg-white/5 border border-white/10 hover:bg-primary/20 hover:text-primary hover:border-primary text-dim font-bold text-[10px] py-3 rounded transition mt-2 uppercase tracking-widest flex justify-center items-center gap-2 group-btn">
                        <i class="fas fa-power-off group-btn-hover:animate-pulse"></i> Initialize
                    </button>
                </div>

                <!-- ACTIVE CONNECTION -->
                <div id="connectedView" class="hidden flex flex-col h-full">
                    <div class="bg-primary/10 border border-primary/20 p-3 rounded mb-4">
                        <div class="text-[9px] text-primary mb-1 font-bold">LINK ESTABLISHED</div>
                        <div id="display_addr" class="font-mono text-[10px] text-white truncate w-40 opacity-80">...</div>
                    </div>
                    
                    <div class="flex-grow">
                        <div class="text-[9px] text-gray-500 uppercase mb-2">Active Gateways</div>
                        <div class="space-y-2">
                            <div class="flex justify-between items-center text-[9px] font-mono bg-black/20 p-1.5 rounded">
                                <span class="text-dim">NODE A</span> <span id="gw_a" class="text-dim bg-white/5 px-2 rounded">IDLE</span>
                            </div>
                            <div class="flex justify-between items-center text-[9px] font-mono bg-black/20 p-1.5 rounded">
                                <span class="text-dim">NODE B</span> <span id="gw_b" class="text-dim bg-white/5 px-2 rounded">IDLE</span>
                            </div>
                        </div>
                    </div>

                    <button onclick="disconnect()" class="mt-auto text-[9px] text-danger/70 hover:text-danger hover:bg-danger/10 border border-danger/30 rounded py-2 transition uppercase">Abort Link</button>
                </div>
            </div>
        </aside>

        <!-- CENTER: VISUALIZATION & CHART -->
        <section class="lg:col-span-6 flex flex-col gap-4">
            
            <!-- PIPELINE -->
            <div class="glass h-16 rounded-lg flex items-center justify-between px-6 border-t border-white/5 relative overflow-hidden">
                <div class="flex flex-col items-center w-8 z-10">
                    <div id="p_1" class="w-2 h-2 bg-dim rounded-full transition-all duration-300"></div><span class="text-[8px] text-dim mt-2 uppercase font-bold">User</span>
                </div>
                <div class="h-[1px] bg-white/10 flex-grow mx-1 relative"><div id="l_1" class="absolute h-full w-0 bg-primary transition-all duration-500"></div></div>
                <div class="flex flex-col items-center w-8 z-10">
                    <div id="p_2" class="w-2 h-2 bg-dim rounded-full transition-all duration-300"></div><span class="text-[8px] text-dim mt-2 uppercase font-bold">Proxy</span>
                </div>
                <div class="h-[1px] bg-white/10 flex-grow mx-1 relative"><div id="l_2" class="absolute h-full w-0 bg-primary transition-all duration-500"></div></div>
                <div class="flex flex-col items-center w-8 z-10">
                    <div id="p_3" class="w-2 h-2 bg-dim rounded-full transition-all duration-300"></div><span class="text-[8px] text-dim mt-2 uppercase font-bold">Pi²</span>
                </div>
                 <div class="h-[1px] bg-white/10 flex-grow mx-1 relative"><div id="l_3" class="absolute h-full w-0 bg-success transition-all duration-500"></div></div>
                <div class="flex flex-col items-center w-8 z-10">
                    <div id="p_4" class="w-3 h-3 border border-dim rounded-full flex items-center justify-center transition-all duration-300 bg-panel">
                        <i id="check_icon" class="fas fa-check text-[7px] text-transparent transition-colors"></i>
                    </div><span class="text-[8px] text-dim mt-2 uppercase font-bold">Final</span>
                </div>
            </div>

            <!-- CHART & OVERLAY -->
            <div class="glass p-1 rounded-lg flex-grow h-[320px] min-h-[320px] relative border border-white/5 flex flex-col">
                 <div class="absolute top-4 left-5 z-20 pointer-events-none flex gap-8">
                     <div>
                         <p class="text-[9px] text-dim uppercase tracking-widest font-bold">Latency</p>
                         <p class="text-2xl font-mono font-bold text-white leading-none glitch-hover"><span id="val_avg">0</span> <span class="text-[10px] text-primary align-top font-bold">ms</span></p>
                     </div>
                     <div>
                         <p class="text-[9px] text-dim uppercase tracking-widest font-bold">Processed</p>
                         <p class="text-2xl font-mono font-bold text-white leading-none"><span id="val_tx">0</span><span class="text-dim text-lg">/20</span></p>
                     </div>
                 </div>
                 
                 <!-- CANVAS -->
                 <div class="relative w-full h-full pt-14 px-2 pb-2">
                     <canvas id="mainChart"></canvas>
                 </div>
            </div>

            <!-- TERMINAL & BUTTON -->
            <div class="grid grid-cols-5 gap-4 h-40">
                <div class="col-span-3 glass p-3 rounded-lg flex flex-col relative bg-black/40 border border-white/5 shadow-inner">
                    <div class="flex-grow overflow-y-auto font-mono text-[9px] space-y-1 pr-2" id="console">
                        <div class="text-primary">> Sentinel OS v15.0 Booted.</div>
                        <div class="text-dim italic">> Sound Engine: Ready.</div>
                        <div class="text-dim italic">> Routing: Multi-path.</div>
                    </div>
                </div>
                
                <div class="col-span-2 glass p-3 rounded-lg flex flex-col justify-center gap-2 relative overflow-hidden">
                    <div class="absolute inset-0 bg-primary/5 opacity-0 hover:opacity-100 transition duration-500 pointer-events-none"></div>
                    <button id="btn_start" onclick="startBenchmark()" disabled class="h-full bg-white/5 border border-white/10 text-dim font-bold font-hud uppercase tracking-[0.2em] text-xs rounded transition-all disabled:opacity-40 disabled:cursor-not-allowed hover:bg-primary/10 hover:text-white hover:border-primary/50 relative overflow-hidden group">
                        <span class="relative z-10">ENGAGE TEST</span>
                    </button>
                    <button onclick="abortSequence()" class="h-8 border border-danger/30 text-danger hover:bg-danger/10 text-[9px] rounded uppercase font-bold transition">Stop</button>
                </div>
            </div>
        </section>

        <!-- RIGHT: FEED & ACHIEVEMENTS -->
        <aside class="lg:col-span-3 h-full flex flex-col gap-4">
            
            <!-- TYPEWRITER INFO FEED -->
            <div class="glass flex-grow rounded-lg p-5 border-t-2 border-accent flex flex-col relative">
                <h3 class="text-[10px] font-bold text-accent uppercase tracking-widest mb-4 flex items-center gap-2">
                    <i class="fas fa-satellite"></i> Knowledge Base
                </h3>

                <div class="flex-grow bg-black/20 rounded p-3 border border-white/5 mb-2 relative overflow-hidden">
                    <!-- Typing container -->
                    <h4 id="info_title" class="text-sm font-bold text-white mb-2">Standby</h4>
                    <div id="typewriter" class="text-[11px] text-gray-300 font-mono leading-relaxed cursor">
                        Awaiting connection. This panel streams real-time Pi2 architectural data.
                    </div>
                </div>
                
                <!-- ACHIEVEMENTS ZONE -->
                <div class="h-20 bg-black/40 rounded p-2 flex gap-2 items-center overflow-x-auto">
                    <div class="text-[8px] text-dim font-mono rotate-180" style="writing-mode: vertical-rl;">BADGES</div>
                    <!-- Badges will be injected here -->
                    <div id="badge_1" class="w-10 h-10 rounded border border-white/5 bg-white/5 flex items-center justify-center opacity-30 grayscale transition-all" title="Connected">
                        <i class="fas fa-plug text-primary"></i>
                    </div>
                    <div id="badge_2" class="w-10 h-10 rounded border border-white/5 bg-white/5 flex items-center justify-center opacity-30 grayscale transition-all" title="Speed Demon (<800ms)">
                        <i class="fas fa-bolt text-yellow-400"></i>
                    </div>
                    <div id="badge_3" class="w-10 h-10 rounded border border-white/5 bg-white/5 flex items-center justify-center opacity-30 grayscale transition-all" title="Completionist">
                        <i class="fas fa-check-circle text-success"></i>
                    </div>
                </div>

                <div class="mt-4 pt-2 border-t border-white/5">
                     <button onclick="downloadCSV()" id="btn_exp" class="hidden w-full bg-success/10 border border-success/30 hover:bg-success/20 text-success text-[10px] py-2.5 rounded transition uppercase font-bold flex items-center justify-center gap-2">
                         <i class="fas fa-save"></i> Save Logs
                     </button>
                </div>
            </div>
        </aside>

    </main>

    <!-- LOGIC -->
    <script>
        const ENDPOINT = "https://api.wallet.fastset.xyz/api/transferToken";
        const PROXIES = [
            (u) => `https://corsproxy.io/?${encodeURIComponent(u)}`, 
            (u) => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}` 
        ];
        const TID = "0xfa575e7000000000000000000000000000000000000000000000000000000000";

        // GLOBAL APP
        window.App = {
            conn: false, run: false, wallet: {},
            lang: 'en', logs: [], ok: 0, 
            mute: false
        };

        // --- AUDIO ENGINE ---
        const AudioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (App.mute) return;
            if (AudioCtx.state === 'suspended') AudioCtx.resume();

            const osc = AudioCtx.createOscillator();
            const gain = AudioCtx.createGain();
            osc.connect(gain);
            gain.connect(AudioCtx.destination);

            if (type === 'click') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(400, AudioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(100, AudioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.05, AudioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, AudioCtx.currentTime + 0.1);
                osc.start(); osc.stop(AudioCtx.currentTime + 0.1);
            } else if (type === 'success') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, AudioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(1200, AudioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.05, AudioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, AudioCtx.currentTime + 0.3);
                osc.start(); osc.stop(AudioCtx.currentTime + 0.3);
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, AudioCtx.currentTime);
                gain.gain.setValueAtTime(0.05, AudioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, AudioCtx.currentTime + 0.2);
                osc.start(); osc.stop(AudioCtx.currentTime + 0.2);
            } else if (type === 'type') {
                // Typewriter tiny click
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(800, AudioCtx.currentTime);
                gain.gain.setValueAtTime(0.01, AudioCtx.currentTime);
                osc.start(); osc.stop(AudioCtx.currentTime + 0.02);
            }
        }

        function toggleMute() {
            App.mute = !App.mute;
            const icon = document.querySelector('#soundToggle i');
            icon.className = App.mute ? 'fas fa-volume-mute text-red-500' : 'fas fa-volume-up text-dim';
        }

        // --- TYPEWRITER ENGINE ---
        let typeInterval;
        function typeWriter(text, elementId) {
            clearInterval(typeInterval);
            const el = document.getElementById(elementId);
            el.innerHTML = ''; // clear
            let i = 0;
            typeInterval = setInterval(() => {
                if (i < text.length) {
                    el.innerHTML += text.charAt(i);
                    i++;
                    if(i%2===0) playSound('type');
                } else {
                    clearInterval(typeInterval);
                }
            }, 30); // Speed
        }

        // DATA
        const DATA = {
            en: [
                {t:"Zero-Knowledge Logic", d:"Pi2 creates a trustless verification layer. Instead of running code blindly, we verify a ZK-proof of its correct execution."},
                {t:"FastSet Speed", d:"You are seeing the 'FastSet' consensus in action. It achieves <1s finality by separating data distribution from validation."},
                {t:"USL Concept", d:"Universal Settlement Layer means Pi2 can be the source of truth for Ethereum, Solana, and Cosmos simultaneously."},
                {t:"The Proxy Factor", d:"Notice latency spikes? That's the HTTP tunnel. Direct nodes are faster. This tool visualizes pathing overhead."},
                {t:"Finality Check", d:"Transactions turn Green when the mathematical proof is verified. No trusted intermediaries required."}
            ],
            ru: [
                {t:"ZK Логика", d:"Pi2 создает слой доверия. Вместо слепого запуска кода, мы проверяем ZK-доказательство его исполнения."},
                {t:"Скорость FastSet", d:"Вы видите FastSet в действии. Разделение распространения данных и валидации дает финализацию <1 сек."},
                {t:"USL Концепт", d:"Universal Settlement Layer: Pi2 может быть источником правды одновременно для ETH, Solana и Cosmos."},
                {t:"Прокси Фактор", d:"Видите скачки пинга? Это туннель HTTP. Прямые ноды работают быстрее. Тулинг показывает издержки пути."},
                {t:"Проверка Финала", d:"Транзакции зеленеют, когда математическое доказательство принято. Посредники не нужны."}
            ]
        };

        // --- CORE ---
        window.onload = () => {
            initChart();
            if(localStorage.getItem('p15_a')) {
                App.wallet = { a:localStorage.getItem('p15_a'), k:localStorage.getItem('p15_k') };
                toggleUI(true);
            }
        };

        function initConnection() {
            playSound('click');
            const a = document.getElementById('inp_addr').value.trim();
            const k = document.getElementById('inp_pk').value.trim();
            if(!a || !k) return alert("Credentials required");
            App.wallet = {a,k};
            localStorage.setItem('p15_a', a); localStorage.setItem('p15_key', k);
            toggleUI(true);
            log("Connection initialized.", 'ok');
            unlockBadge(1); // Achievement: Connected
        }

        function disconnect() {
            playSound('click');
            localStorage.clear(); App.wallet={}; toggleUI(false);
            log("Link severed.", 'dim');
        }

        function toggleUI(on) {
            App.conn = on;
            const setup=document.getElementById('setupView');
            const conn=document.getElementById('connectedView');
            const btn=document.getElementById('btn_start');
            if(on) {
                setup.classList.add('hidden'); conn.classList.remove('hidden');
                document.getElementById('display_addr').innerText = App.wallet.a;
                btn.disabled=false;
                btn.classList.remove('bg-white/5','text-dim'); 
                btn.classList.add('bg-primary/20','border-primary','text-primary','shadow-[0_0_20px_rgba(0,243,255,0.2)]');
                
                typeWriter(DATA[App.lang][0].d, 'typewriter'); // Start typing info
                document.getElementById('info_title').innerText = DATA[App.lang][0].t;
            } else {
                setup.classList.remove('hidden'); conn.classList.add('hidden');
                btn.disabled=true; 
                btn.classList.add('bg-white/5','text-dim'); 
                btn.classList.remove('bg-primary/20','border-primary','text-primary','shadow-[0_0_20px_rgba(0,243,255,0.2)]');
                btn.innerText="ENGAGE TEST";
            }
        }

        // --- BENCHMARK ---
        async function startBenchmark() {
            if(App.run) return;
            playSound('click');
            App.run = true; App.ok = 0;
            
            document.getElementById('btn_start').innerText = "PROCESSING...";
            document.getElementById('btn_exp').classList.add('hidden');
            resetChart(); anim(0);

            startRotation(); // Start text rotation

            for(let i=1; i<=20; i++) {
                if(!App.run) break;

                // Gateway Visuals
                const pIdx = i % 2;
                document.getElementById('gw_a').className = pIdx===0 ? "text-primary bg-primary/20 px-2 rounded font-bold" : "text-dim bg-white/5 px-2 rounded";
                document.getElementById('gw_a').innerText = pIdx===0 ? "TXIO" : "IDLE";
                document.getElementById('gw_b').className = pIdx===1 ? "text-primary bg-primary/20 px-2 rounded font-bold" : "text-dim bg-white/5 px-2 rounded";
                document.getElementById('gw_b').innerText = pIdx===1 ? "TXIO" : "IDLE";

                anim(1);
                log(`Sequence #${i}: Encrypt & Broadcast...`, 'norm');
                const start = Date.now();
                anim(2); 

                const url = PROXIES[pIdx](ENDPOINT);

                try {
                    const r = await fetch(url, {
                        method:'POST', headers:{'Content-Type':'application/json'},
                        body: JSON.stringify({ sender: App.wallet.a, recipient: App.wallet.a, amount:"1", tokenId:TID, privateKey: App.wallet.k })
                    });
                    
                    if(!r.ok && r.status !== 200) throw new Error("Status " + r.status);
                    
                    anim(3); // Network hit
                    const ms = Date.now() - start;
                    anim(4); // Final

                    App.ok++;
                    updateChart(i, ms);
                    
                    // ACHIEVEMENTS LOGIC
                    if(ms < 800) unlockBadge(2); // Speed demon
                    if(i === 20 && App.ok === 20) unlockBadge(3); // Perfect run

                    log(`> [OK] Finality Reached: ${ms}ms`, 'ok');
                    playSound('success');
                    
                    await sleep(2000);
                    anim(0);

                } catch(e) {
                    playSound('error');
                    log(`> [ERR] Route failure. Switching node...`, 'err');
                    await sleep(3000); 
                    anim(0);
                }
            }
            stop();
        }

        function stop() {
            App.run = false;
            clearInterval(App.infoTimer);
            document.getElementById('btn_start').innerText = "ENGAGE TEST";
            if(App.ok > 0) document.getElementById('btn_exp').classList.remove('hidden');
            log("Diagnostic Cycle Complete.", 'norm');
            playSound('success');
        }

        // --- ANIMATIONS ---
        function anim(s) {
            const A="bg-primary shadow-[0_0_10px_cyan]"; const I="bg-dim";
            const p=(id,on)=>document.getElementById(id).className=`w-2.5 h-2.5 rounded-full transition-all duration-300 ${on?A:I}`;
            p('p_1', s>=1); p('p_2', s>=2); p('p_3', s>=3);
            
            const l=(id,on)=>document.getElementById(id).style.width=on?"100%":"0%";
            l('l_1', s>=2); l('l_2', s>=3); l('l_3', s>=4);

            const end = document.getElementById('p_4');
            const ico = document.getElementById('check_icon');
            if(s>=4) { end.className="w-3.5 h-3.5 bg-success rounded-full flex justify-center items-center shadow-[0_0_10px_lime]"; ico.classList.remove('text-transparent'); ico.classList.add('text-black'); }
            else { end.className="w-3.5 h-3.5 bg-panel border border-dim rounded-full flex justify-center items-center"; ico.classList.add('text-transparent'); }
        }

        // --- INFO & BADGES ---
        function startRotation() {
            let idx = 0;
            App.infoTimer = setInterval(() => {
                idx = (idx + 1) % DATA[App.lang].length;
                const item = DATA[App.lang][idx];
                document.getElementById('info_title').innerText = item.t;
                typeWriter(item.d, 'typewriter');
                playSound('click'); // subtle tick on slide change
            }, 8000); // 8s per slide to read
        }

        function unlockBadge(id) {
            const b = document.getElementById(`badge_${id}`);
            if(b.classList.contains('opacity-30')) {
                b.classList.remove('opacity-30', 'grayscale');
                b.classList.add('bg-white/10', 'pop-in', 'shadow-[0_0_10px_white]');
                log(`*** ACHIEVEMENT UNLOCKED: #${id} ***`, 'ok');
                playSound('success');
            }
        }

        // --- HELPERS ---
        let myChart;
        function log(m,t) {
            const c=t==='ok'?'text-success':t==='err'?'text-danger':'text-dim';
            const el = document.createElement('div');
            el.innerHTML = `<span class="opacity-50 text-[9px] mr-2">::</span><span class="${c}">${m}</span>`;
            document.getElementById('console').prepend(el);
        }
        function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
        
        function updateChart(i, ms) {
            myChart.data.labels.push(i); myChart.data.datasets[0].data.push(ms);
            document.getElementById('val_tx').innerText = i;
            const avg = (myChart.data.datasets[0].data.reduce((a,b)=>a+b,0)/i).toFixed(0);
            document.getElementById('val_avg').innerText = avg;
            if(myChart.data.labels.length>20) { myChart.data.labels.shift(); myChart.data.datasets[0].data.shift(); }
            myChart.update();
        }
        
        function resetChart() { myChart.data.labels=[]; myChart.data.datasets[0].data=[]; myChart.update(); document.getElementById('val_avg').innerText='0'; }
        
        function initChart() {
            const ctx=document.getElementById('mainChart').getContext('2d');
            const g=ctx.createLinearGradient(0,0,0,300); g.addColorStop(0,'rgba(0,243,255,0.2)'); g.addColorStop(1,'rgba(0,0,0,0)');
            myChart=new Chart(ctx,{type:'line',data:{labels:[],datasets:[{data:[],borderColor:'#00f3ff',borderWidth:2,backgroundColor:g,fill:true,tension:0.4,pointRadius:0}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:false},scales:{x:{display:false},y:{grid:{color:'rgba(255,255,255,0.05)'},ticks:{color:'#64748b'}}}}});
        }
        
        function toggleLang(){ App.lang = App.lang==='en'?'ru':'en'; document.getElementById('langBtn').innerText=App.lang.toUpperCase(); }
    </script>
</body>
</html>
