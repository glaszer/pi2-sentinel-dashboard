<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi2 Sentinel | Network Monitor</title>
    
    <!-- FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <!-- LIBS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- THEME CONFIG -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        pi: {
                            bg: '#050508',
                            card: '#0f0f16',
                            primary: '#00e5ff',
                            secondary: '#7c3aed',
                            success: '#10b981',
                            danger: '#ef4444',
                            text: '#e2e8f0',
                            dim: '#64748b'
                        }
                    },
                    fontFamily: {
                        mono: ['"JetBrains Mono"', 'monospace'],
                        sans: ['"Inter"', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #050508; overflow-x: hidden; }
        .glass {
            background: rgba(15, 15, 22, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.4);
        }
        .neon-focus:focus {
            outline: none;
            border-color: #00e5ff;
            box-shadow: 0 0 15px rgba(0, 229, 255, 0.2);
        }
        .scanline {
            width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, #00e5ff, transparent);
            position: absolute; opacity: 0.3;
            animation: scan 3s linear infinite;
        }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f0f16; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #00e5ff; }
    </style>
</head>
<body class="text-pi-text font-sans antialiased relative selection:bg-pi-primary selection:text-black">

    <!-- ANIMATED BG -->
    <canvas id="particles" class="fixed top-0 left-0 w-full h-full pointer-events-none opacity-20 z-0"></canvas>

    <div class="relative z-10 max-w-7xl mx-auto px-4 py-6 min-h-screen flex flex-col">

        <!-- HEADER -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 glass rounded-2xl p-5 gap-4">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-pi-secondary to-pi-primary flex items-center justify-center font-bold text-black text-2xl shadow-lg shadow-pi-primary/20">œÄ¬≤</div>
                <div>
                    <h1 class="text-2xl font-bold tracking-widest text-white">SENTINEL <span class="text-xs align-top text-pi-primary bg-pi-primary/10 border border-pi-primary/30 px-2 py-0.5 rounded ml-1">v7.0</span></h1>
                    <p class="text-xs text-pi-dim font-mono tracking-widest">Universal Settlement Layer Monitor</p>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="text-right hidden md:block">
                    <p class="text-xs text-pi-dim">SYSTEM STATUS</p>
                    <p class="text-xs font-mono text-pi-success flex items-center gap-1 justify-end"><span class="w-1.5 h-1.5 bg-pi-success rounded-full animate-pulse"></span> ONLINE</p>
                </div>
                <button onclick="toggleLang()" class="text-xs font-bold border border-white/10 px-4 py-2 rounded hover:bg-white/5 transition hover:text-pi-primary" id="btn_lang">EN / RU</button>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <main class="grid grid-cols-1 lg:grid-cols-12 gap-6 flex-grow">
            
            <!-- LEFT PANEL: CONFIG & INFO -->
            <aside class="lg:col-span-4 flex flex-col gap-6">
                
                <!-- CONNECTION CARD -->
                <div class="glass rounded-xl p-6 relative overflow-hidden transition hover:border-pi-primary/30">
                    <h2 class="text-sm font-bold text-white mb-4 flex items-center gap-2 border-b border-white/5 pb-2">
                        <i class="fas fa-satellite-dish text-pi-primary"></i> <span id="lbl_conn">UPLINK CONFIGURATION</span>
                    </h2>

                    <!-- ALERT -->
                    <div class="bg-red-900/20 border-l-2 border-pi-danger p-3 mb-5 text-xs text-red-200">
                        <strong class="block mb-1"><i class="fas fa-shield-alt"></i> SECURITY WARNING</strong>
                        <span id="txt_warning">Use BURNER (Testnet) wallets only. Keys are stored in your browser's LocalStorage.</span>
                    </div>

                    <!-- FORM -->
                    <div id="setupForm" class="space-y-4">
                        <div class="group">
                            <label class="text-[10px] text-pi-dim font-bold tracking-wider uppercase mb-1 block">Set1 Address</label>
                            <input type="text" id="inp_addr" class="w-full bg-black/40 border border-white/10 rounded-lg p-3 text-xs font-mono text-pi-primary neon-focus transition placeholder-gray-700" placeholder="set1...">
                        </div>
                        <div class="group">
                            <label class="text-[10px] text-pi-dim font-bold tracking-wider uppercase mb-1 block">Private Key</label>
                            <input type="password" id="inp_pk" class="w-full bg-black/40 border border-white/10 rounded-lg p-3 text-xs font-mono text-pi-primary neon-focus transition placeholder-gray-700" placeholder="0x...">
                        </div>
                        <button onclick="saveConfig()" id="btn_connect" class="w-full bg-white/5 hover:bg-pi-primary hover:text-black border border-pi-primary/50 text-pi-primary font-bold py-3 rounded-lg transition duration-300 flex justify-center items-center gap-2 text-xs tracking-wider">
                            INITIALIZE CONNECTION <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>

                    <!-- CONNECTED STATE -->
                    <div id="connectedView" class="hidden flex flex-col items-center justify-center py-4 space-y-4 animate-in fade-in">
                        <div class="relative">
                            <div class="absolute inset-0 bg-pi-success blur-xl opacity-20"></div>
                            <div class="w-16 h-16 rounded-full border-2 border-pi-success/50 flex items-center justify-center relative bg-black/50">
                                <i class="fas fa-link text-pi-success text-xl"></i>
                            </div>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-pi-dim mb-1">Target Address</p>
                            <p id="display_addr" class="font-mono text-pi-primary text-xs bg-pi-primary/5 px-2 py-1 rounded border border-pi-primary/10">...</p>
                        </div>
                        <button onclick="disconnect()" class="text-[10px] text-pi-danger hover:underline opacity-80 mt-2">TERMINATE SESSION</button>
                    </div>
                </div>

                <!-- ACADEMY WIDGET -->
                <div class="glass rounded-xl p-6 flex-grow flex flex-col">
                    <h3 class="text-sm font-bold text-white mb-4 flex justify-between items-center">
                        <span id="lbl_academy">üß† KNOWLEDGE BASE</span>
                        <span class="text-[10px] bg-pi-secondary/20 text-pi-secondary px-2 py-0.5 rounded">WIKI</span>
                    </h3>
                    
                    <div class="space-y-3 overflow-y-auto pr-1 h-64 custom-scroll text-xs" id="edu_content">
                        <!-- Dynamic content -->
                    </div>
                </div>

            </aside>

            <!-- RIGHT PANEL: DASHBOARD -->
            <section class="lg:col-span-8 flex flex-col gap-6">
                
                <!-- METRICS GRID -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="glass p-4 rounded-xl relative overflow-hidden">
                        <p class="text-[10px] text-pi-dim font-bold tracking-wider uppercase mb-1">Status</p>
                        <p id="val_status" class="text-lg font-mono font-bold text-gray-500">IDLE</p>
                        <div class="absolute bottom-0 left-0 w-full h-1 bg-gray-500/20" id="bar_status"></div>
                    </div>
                    <div class="glass p-4 rounded-xl">
                        <p class="text-[10px] text-pi-dim font-bold tracking-wider uppercase mb-1">Latency</p>
                        <p class="text-lg font-mono font-bold text-pi-primary"><span id="val_lat">--</span> ms</p>
                    </div>
                    <div class="glass p-4 rounded-xl">
                        <p class="text-[10px] text-pi-dim font-bold tracking-wider uppercase mb-1">Success</p>
                        <p class="text-lg font-mono font-bold text-pi-secondary"><span id="val_rate">--</span>%</p>
                    </div>
                    <div class="glass p-4 rounded-xl">
                        <p class="text-[10px] text-pi-dim font-bold tracking-wider uppercase mb-1">Txs</p>
                        <p class="text-lg font-mono font-bold text-white"><span id="val_txs">0</span>/20</p>
                    </div>
                </div>

                <!-- CHART AREA -->
                <div class="glass p-5 rounded-xl flex-grow min-h-[350px] relative border border-white/5">
                    <div class="absolute top-4 right-5 z-20">
                         <div id="liveIndicator" class="hidden flex items-center gap-2 px-3 py-1 bg-black/40 border border-pi-danger/50 rounded-full text-pi-danger text-[10px] font-bold shadow-lg shadow-red-900/20 animate-pulse">
                            <span class="w-1.5 h-1.5 bg-pi-danger rounded-full"></span> LIVE FEED
                        </div>
                    </div>
                    <canvas id="mainChart"></canvas>
                </div>

                <!-- CONSOLE & CONTROLS -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 h-48">
                    <!-- TERMINAL -->
                    <div class="md:col-span-2 glass rounded-xl p-3 bg-black/60 font-mono text-[10px] overflow-y-auto relative custom-scroll border border-white/5" id="console">
                        <div class="scanline pointer-events-none"></div>
                        <div class="text-pi-primary mb-1">> Pi Squared Sentinel v7.0 loaded...</div>
                        <div class="text-pi-dim mb-1">> Ready to monitor Universal Settlement Layer.</div>
                        <div class="text-gray-600 italic">> Waiting for user input...</div>
                    </div>

                    <!-- ACTION BUTTONS -->
                    <div class="glass rounded-xl p-4 flex flex-col justify-center gap-3">
                         <button id="btn_start" onclick="startTest()" disabled class="w-full bg-gradient-to-r from-pi-primary to-pi-secondary hover:opacity-90 disabled:opacity-20 disabled:cursor-not-allowed text-black font-bold py-4 rounded-lg text-xs transition shadow-lg shadow-pi-primary/20 tracking-wider">
                            START BENCHMARK
                        </button>
                        <button onclick="stopTest()" class="w-full bg-white/5 hover:bg-white/10 text-pi-dim hover:text-white text-xs py-2 rounded-lg transition border border-white/5">
                            STOP SYSTEM
                        </button>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="mt-8 text-center text-[10px] text-pi-dim opacity-40">
            SENTINEL MONITOR | UNOFFICIAL TOOL FOR PI SQUARED COMMUNITY | BUILD v7.0.2
        </footer>

    </div>

    <!-- JAVASCRIPT ENGINE -->
    <script>
        // --- üì° CORE CONFIG ---
        
        // –ú–∞—Å—Å–∏–≤ –ø—Ä–æ–∫—Å–∏ –¥–ª—è —Ä–æ—Ç–∞—Ü–∏–∏. –ï—Å–ª–∏ –æ–¥–∏–Ω –ø–∞–¥–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π.
        const ENDPOINT = "https://api.wallet.fastset.xyz/api/transferToken";
        const PROXIES = [
            (url) => `https://corsproxy.io/?${encodeURIComponent(url)}`,
            (url) => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}` 
        ];
        
        const TOKEN_ID = "0xfa575e7000000000000000000000000000000000000000000000000000000000";

        // --- STATE MANAGER ---
        let lang = 'en';
        let isRunning = false;
        let chart;
        let stats = { ok: 0, fail: 0, total: 0 };
        let wallet = { a: '', k: '' };

        // --- DICTIONARY ---
        const TX = {
            en: {
                h_con: "UPLINK CONFIG", bn_con: "CONNECT", st_idle: "IDLE", st_run: "RUNNING...",
                btn_run: "START BENCHMARK",
                warn: "Security: Use TESTNET wallets only. Keys stored locally.",
                wiki: [
                    { t: "Why is 'set1' address required?", d: "Pi Squared is based on Cosmos SDK architecture, which uses 'set1' Bech32 addresses instead of Ethereum '0x'." },
                    { t: "What is FastSet?", d: "It is the consensus mechanism ensuring finality in <1 second. This tool measures its real-time performance." },
                    { t: "Why Proxy Rotation?", d: "To stress-test from a browser, we rotate between CORS proxies. If one fails (Rate Limit), we switch to another." }
                ]
            },
            ru: {
                h_con: "–ù–ê–°–¢–†–û–ô–ö–ê", bn_con: "–ü–û–î–ö–õ–Æ–ß–ò–¢–¨", st_idle: "–û–ñ–ò–î–ê–ù–ò–ï", st_run: "–†–ê–ë–û–¢–ê...",
                btn_run: "–ó–ê–ü–£–°–¢–ò–¢–¨ –¢–ï–°–¢",
                warn: "–í–Ω–∏–º–∞–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–æ—à–µ–ª—å–∫–∏. –ö–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ.",
                wiki: [
                    { t: "–ü–æ—á–µ–º—É –∞–¥—Ä–µ—Å 'set1'?", d: "Pi Squared –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ Cosmos SDK, –≥–¥–µ –∞–¥—Ä–µ—Å–∞ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è –Ω–∞ 'set1' (Bech32), –∞ –Ω–µ –Ω–∞ '0x' –∫–∞–∫ –≤ Ethereum." },
                    { t: "–ß—Ç–æ —Ç–∞–∫–æ–µ FastSet?", d: "–ú–µ—Ö–∞–Ω–∏–∑–º –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞ —Å —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π <1 —Å–µ–∫. –≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑–∞–º–µ—Ä—è–µ—Ç –µ–≥–æ —Ä–µ–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å." },
                    { t: "–ó–∞—á–µ–º —Ä–æ—Ç–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏?", d: "–ß—Ç–æ–±—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç—å –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫, –º—ã –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —à–ª—é–∑—ã, –µ—Å–ª–∏ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É." }
                ]
            }
        };

        // --- INIT ---
        window.onload = () => {
            initParticles();
            initChart();
            renderWiki();
            
            if(localStorage.getItem('pi2_a')) {
                wallet.a = localStorage.getItem('pi2_a');
                wallet.k = localStorage.getItem('pi2_k');
                toggleUI(true);
            }
        };

        function toggleLang() {
            lang = lang === 'en' ? 'ru' : 'en';
            document.getElementById('btn_lang').innerText = lang.toUpperCase() + ' / ' + (lang==='en'?'RU':'EN');
            
            // Text updates
            document.getElementById('lbl_conn').innerText = TX[lang].h_con;
            document.getElementById('btn_connect').innerHTML = `${TX[lang].bn_con} <i class="fas fa-arrow-right"></i>`;
            document.getElementById('txt_warning').innerText = TX[lang].warn;
            document.getElementById('btn_start').innerText = TX[lang].btn_run;
            document.getElementById('val_status').innerText = isRunning ? TX[lang].st_run : TX[lang].st_idle;
            
            renderWiki();
        }

        function renderWiki() {
            const div = document.getElementById('edu_content');
            div.innerHTML = '';
            TX[lang].wiki.forEach(w => {
                const el = document.createElement('div');
                el.className = "group border-l-2 border-white/5 pl-3 hover:border-pi-primary transition-all duration-300";
                el.innerHTML = `
                    <h4 class="text-pi-primary font-bold mb-1 group-hover:text-white">${w.t}</h4>
                    <p class="text-pi-dim opacity-70 leading-relaxed group-hover:opacity-100">${w.d}</p>
                `;
                div.appendChild(el);
            });
        }

        // --- CONNECTION LOGIC ---
        function saveConfig() {
            const a = document.getElementById('inp_addr').value.trim();
            const k = document.getElementById('inp_pk').value.trim();
            if(!a.startsWith('set1') || !k.startsWith('0x')) return alert("Invalid Address (needs set1) or Key (needs 0x)");
            
            localStorage.setItem('pi2_a', a);
            localStorage.setItem('pi2_k', k);
            wallet.a = a; wallet.k = k;
            toggleUI(true);
            log("Credentials encrypted & saved in LocalStorage.", 'ok');
        }

        function disconnect() {
            localStorage.clear(); wallet={a:'',k:''}; toggleUI(false);
            log("Session terminated. Keys wiped.", 'warn');
        }

        function toggleUI(connected) {
            const f = document.getElementById('setupForm');
            const v = document.getElementById('connectedView');
            const btn = document.getElementById('btn_start');
            
            if(connected) {
                f.classList.add('hidden'); v.classList.remove('hidden'); btn.disabled = false;
                document.getElementById('display_addr').innerText = wallet.a;
                document.getElementById('val_status').innerText = "READY";
            } else {
                f.classList.remove('hidden'); v.classList.add('hidden'); btn.disabled = true;
                document.getElementById('val_status').innerText = "IDLE";
            }
        }

        // --- üöÄ BENCHMARK ENGINE (WITH PROXY ROTATION) ---
        async function startTest() {
            if(isRunning) return;
            isRunning = true;
            updateStatus(true);
            
            stats = { ok: 0, fail: 0, total: 0 };
            chart.data.labels = []; chart.data.datasets[0].data = []; chart.update();
            updateStatsDOM();
            
            log("Initializing proxy tunnel...", 'info');
            
            const MAX_TX = 20;
            let proxyIndex = 0; // –ù–∞—á–∏–Ω–∞–µ–º —Å –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ–∫—Å–∏

            for(let i=1; i<=MAX_TX; i++) {
                if(!isRunning) break;
                
                // –í–´–ë–û–† –ü–†–û–ö–°–ò:
                // –ú—ã –±–µ—Ä–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ –º–∞—Å—Å–∏–≤–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É (—Å –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ–º)
                const buildUrl = PROXIES[proxyIndex % PROXIES.length];
                const activeUrl = buildUrl(ENDPOINT);
                
                // –û–±–æ–∑–Ω–∞—á–∞–µ–º, —á–µ—Ä–µ–∑ —á—Ç–æ –∏–¥–µ–º (G1 –∏–ª–∏ G2)
                const gwLabel = (proxyIndex % PROXIES.length) === 0 ? "Pri" : "Bck";

                log(`[TX #${i}] Broadcasting (Gw:${gwLabel})...`, 'dim');
                const start = Date.now();

                try {
                    const resp = await fetch(activeUrl, {
                        method: 'POST',
                        // Minimal headers to avoid triggering bots
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            sender: wallet.a, recipient: wallet.a, 
                            amount: "1", tokenId: TOKEN_ID, privateKey: wallet.k
                        })
                    });

                    // –ß–∏—Ç–∞–µ–º —Ç–µ–∫—Å—Ç, —Ç–∞–∫ –∫–∞–∫ 'raw' endpoint –º–æ–∂–µ—Ç –≤–µ—Å—Ç–∏ —Å–µ–±—è –ø–æ —Ä–∞–∑–Ω–æ–º—É
                    const text = await resp.text();
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞: —É—Å–ø–µ—à–µ–Ω –ª–∏ –∑–∞–ø—Ä–æ—Å
                    // –õ–∏–±–æ HTTP 200, –õ–∏–±–æ AllOrigins 'raw' –ø—Ä–æ–ø—É—Å–∫
                    if(resp.ok) {
                         const ms = Date.now() - start;
                         stats.ok++;
                         updateChart(i, ms);
                         log(`‚úÖ #${i} CONFIRMED: ${ms}ms`, 'ok');
                         
                         // –£—Å–ø–µ—Ö? –ñ–¥–µ–º 2 —Å–µ–∫.
                         await sleep(2000); 
                    } else {
                         // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª 4xx/5xx - —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–∞–Ω –ø—Ä–æ–∫—Å–∏
                         throw new Error(`HTTP ${resp.status}`);
                    }

                } catch(e) {
                    stats.fail++;
                    log(`‚ö†Ô∏è #${i} REJECTED (${e.message}). Rotating Proxy...`, 'warn');
                    
                    // ! ROTATION MAGIC !
                    // –ú–µ–Ω—è–µ–º –∏–Ω–¥–µ–∫—Å –ø—Ä–æ–∫—Å–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π
                    proxyIndex++; 
                    
                    // –ù–∞–∫–∞–∑–∞–Ω–∏–µ: –∂–¥–µ–º –¥–æ–ª—å—à–µ (3.5 —Å–µ–∫) –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–æ–π
                    await sleep(3500);
                }

                stats.total = i;
                updateStatsDOM();
            }
            
            stopTest();
        }

        function stopTest() {
            isRunning = false;
            updateStatus(false);
            log(`Benchmark Finished. Success Rate: ${(stats.ok/Math.max(stats.total,1)*100).toFixed(0)}%`, 'info');
        }

        function updateStatsDOM() {
            document.getElementById('val_txs').innerText = stats.total;
            const rate = stats.total > 0 ? (stats.ok/stats.total*100) : 0;
            document.getElementById('val_rate').innerText = rate.toFixed(0);
        }

        function updateStatus(active) {
            const st = document.getElementById('val_status');
            const ind = document.getElementById('liveIndicator');
            const bar = document.getElementById('bar_status');
            
            if(active) {
                st.innerText = TX[lang].st_run;
                st.classList.add('text-pi-primary', 'animate-pulse');
                st.classList.remove('text-gray-500');
                ind.classList.remove('hidden');
                bar.classList.add('bg-pi-primary'); bar.classList.remove('bg-gray-500/20');
            } else {
                st.innerText = TX[lang].st_idle;
                st.classList.remove('text-pi-primary', 'animate-pulse');
                st.classList.add('text-gray-500');
                ind.classList.add('hidden');
                bar.classList.remove('bg-pi-primary'); bar.classList.add('bg-gray-500/20');
            }
        }

        function updateChart(label, data) {
            chart.data.labels.push(label);
            chart.data.datasets[0].data.push(data);
            
            // –ï—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ç–æ—á–µ–∫, —Å–¥–≤–∏–≥–∞–µ–º
            if(chart.data.labels.length > 20) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
            }
            chart.update();
            document.getElementById('val_lat').innerText = data;
        }

        // --- HELPERS ---
        const sleep = ms => new Promise(r => setTimeout(r, ms));

        function log(msg, type) {
            const con = document.getElementById('console');
            const el = document.createElement('div');
            el.innerHTML = `<span class="opacity-50">[${new Date().toLocaleTimeString('en-GB')}]</span> ${msg}`;
            
            if(type==='ok') el.className = 'text-pi-success';
            else if(type==='warn') el.className = 'text-pi-danger';
            else if(type==='info') el.className = 'text-pi-primary';
            else el.className = 'text-pi-dim';
            
            con.prepend(el);
            if(con.children.length > 30) con.lastElementChild.remove();
        }

        function initChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const grad = ctx.createLinearGradient(0,0,0,300);
            grad.addColorStop(0, 'rgba(0, 229, 255, 0.2)');
            grad.addColorStop(1, 'rgba(0, 229, 255, 0)');
            
            chart = new Chart(ctx, {
                type: 'line',
                data: { labels:[], datasets:[{
                    label: 'Latency', data:[], borderColor:'#00e5ff', borderWidth:2, 
                    backgroundColor: grad, fill:true, tension:0.4, 
                    pointBackgroundColor:'#050508', pointBorderColor:'#fff'
                }]},
                options: {
                    responsive:true, maintainAspectRatio:false,
                    plugins: { legend: {display:false} },
                    scales: {
                        x: { display:false },
                        y: { grid: {color:'rgba(255,255,255,0.05)'}, ticks:{color:'#64748b', font:{family:'JetBrains Mono'}} }
                    }
                }
            });
        }
        
        function initParticles(){const c=document.getElementById('particles'),x=c.getContext('2d');
        c.width=window.innerWidth;c.height=window.innerHeight;
        let p=Array(50).fill().map(()=>({x:Math.random()*c.width,y:Math.random()*c.height,vx:(Math.random()-.5)*.3,vy:(Math.random()-.5)*.3,s:Math.random()*2}));
        function a(){x.clearRect(0,0,c.width,c.height);x.fillStyle="#00e5ff";
        p.forEach(e=>{e.x+=e.vx;e.y+=e.vy;if(e.x<0)e.x=c.width;if(e.x>c.width)e.x=0;if(e.y<0)e.y=c.height;if(e.y>c.height)e.y=0;
        x.beginPath();x.arc(e.x,e.y,e.s,0,Math.PI*2);x.fill()});requestAnimationFrame(a)}a()}
    </script>
</body>
</html>
